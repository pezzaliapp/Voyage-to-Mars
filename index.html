<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Viaggio su Marte - CesiumJS</title>
    <script src="https://cesium.com/downloads/cesiumjs/releases/1.117/Build/Cesium/Cesium.js"></script>
    <link href="https://cesium.com/downloads/cesiumjs/releases/1.117/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
    <style>
        html, body, #cesiumContainer {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        #controls {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 10;
            background: rgba(0,0,0,0.6);
            color: white;
            padding: 10px;
            border-radius: 5px;
        }
        button {
            margin-top: 8px;
            padding: 6px 12px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="cesiumContainer"></div>
    <div id="controls">
        <h3>Viaggio Terra → Marte</h3>
        <button id="startJourney">Inizia il viaggio</button>
    </div>

    <script>
        // Disabilita il logo Cesium (opzionale)
        Cesium.buildModuleUrl.setBaseUrl('https://cesium.com/downloads/cesiumjs/releases/1.117/Build/Cesium/');

        // Inizializza il viewer
        const viewer = new Cesium.Viewer('cesiumContainer', {
            shouldAnimate: true,
            timeline: false,
            animation: false,
            fullscreenButton: false,
            vrButton: false,
            geocoder: false,
            homeButton: false,
            sceneModePicker: false,
            navigationHelpButton: false,
            infoBox: false,
            scene3DOnly: true
        });

        // Rimuovi la Terra (per mostrare solo lo spazio)
        viewer.scene.globe.show = false;
        viewer.scene.skyBox.show = true;
        viewer.scene.backgroundColor = Cesium.Color.BLACK;

        // Aggiungi il Sole al centro
        const sun = viewer.entities.add({
            position: Cesium.Cartesian3.fromDegrees(0, 0, 0),
            billboard: {
                image: 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32"><circle cx="16" cy="16" r="14" fill="yellow"/></svg>',
                scale: 2.0
            }
        });

        // Posizioni approssimate (semplificate)
        const earthPosition = Cesium.Cartesian3.fromDegrees(0, 0, 150000000); // 150 milioni di km
        const marsPosition = Cesium.Cartesian3.fromDegrees(0, 0, 228000000);  // 228 milioni di km

        // Aggiungi la Terra
        const earth = viewer.entities.add({
            position: earthPosition,
            ellipse: {
                semiMinorAxis: 6371000,
                semiMajorAxis: 6371000,
                height: 0,
                material: Cesium.Color.BLUE.withAlpha(0.8),
                extrudedHeight: 0
            },
            billboard: {
                image: 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="blue"/></svg>',
                scale: 0.5
            }
        });

        // Aggiungi Marte
        const mars = viewer.entities.add({
            position: marsPosition,
            billboard: {
                image: 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="red"/></svg>',
                scale: 0.5
            }
        });

        // Nave spaziale (inizialmente sulla Terra)
        const spacecraft = viewer.entities.add({
            position: earthPosition,
            billboard: {
                image: 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><polygon points="50,10 40,40 60,40" fill="white"/></svg>',
                scale: 0.3
            }
        });

        // Funzione per interpolare la traiettoria (orbita ellittica semplificata)
        function createTrajectory(start, end, steps = 200) {
            const positions = [];
            for (let i = 0; i <= steps; i++) {
                const t = i / steps;
                // Interpolazione lineare (per semplicità; in realtà sarebbe ellittica)
                const x = Cesium.Cartesian3.multiplyByScalar(start, 1 - t, new Cesium.Cartesian3());
                const y = Cesium.Cartesian3.multiplyByScalar(end, t, new Cesium.Cartesian3());
                const pos = Cesium.Cartesian3.add(x, y, new Cesium.Cartesian3());
                positions.push(pos);
            }
            return positions;
        }

        // Avvia il viaggio
        document.getElementById('startJourney').addEventListener('click', () => {
            const trajectory = createTrajectory(earthPosition, marsPosition);
            let index = 0;
            const durationPerStep = 50; // ms

            function animate() {
                if (index < trajectory.length) {
                    spacecraft.position = trajectory[index];
                    viewer.camera.lookAt(
                        trajectory[index],
                        new Cesium.Cartesian3(0, -50000000, 0) // posizione camera relativa
                    );
                    index++;
                    setTimeout(animate, durationPerStep);
                } else {
                    // Arrivato su Marte
                    viewer.camera.flyTo({
                        destination: Cesium.Cartesian3.add(marsPosition, new Cesium.Cartesian3(0, -80000000, 0), new Cesium.Cartesian3()),
                        duration: 2.0
                    });
                }
            }

            animate();
        });

        // Imposta vista iniziale
        viewer.camera.flyTo({
            destination: Cesium.Cartesian3.fromDegrees(0, 0, 300000000),
            orientation: {
                heading: Cesium.Math.toRadians(0),
                pitch: Cesium.Math.toRadians(-90),
                roll: 0.0
            },
            duration: 0
        });
    </script>
</body>
</html>
